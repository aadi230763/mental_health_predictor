trigger:
  branches:
    include:
      - main

pool:
  name: Default  # Your self-hosted agent pool name

variables:
  azureWebAppName: 'EmployeeWise'
  packagePath: '$(Build.ArtifactStagingDirectory)/flaskapp.zip'

steps:

# ✅ Step 1: Install Python dependencies (using system Python)
- script: |
    python3 -m pip install --upgrade pip
    pip3 install -r requirements.txt
  displayName: 'Install Python Dependencies'

# ✅ Step 2: Archive the app
- task: ArchiveFiles@2
  inputs:
    rootFolderOrFile: '$(Build.SourcesDirectory)'
    includeRootFolder: false
    archiveType: 'zip'
    archiveFile: '$(packagePath)'
    replaceExistingArchive: true
  displayName: 'Archive Flask App'

# ✅ Step 3: Publish build artifacts
- task: PublishBuildArtifacts@1
  inputs:
    pathToPublish: '$(Build.ArtifactStagingDirectory)'
    artifactName: 'drop'
    publishLocation: 'Container'
  displayName: 'Publish Build Artifact'

# ✅ Step 4: Deploy to Azure Web App
- task: AzureWebApp@1
  inputs:
    azureSubscription: 'Azure subscription 1'  # Your service connection name
    appType: 'webAppLinux'
    appName: '$(azureWebAppName)'
    package: '$(packagePath)'
  displayName: 'Deploy to Azure Web App'
